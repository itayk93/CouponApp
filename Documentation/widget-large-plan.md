# אפיון ותוכנית עבודה – וידג'ט גדול (Large)

## מטרות
- יישור קו עם הקונספט בשקף: כרטיסים בהירים, רקע גרדיאנט רך, הדגשת תוקף קרוב.
- הצגת עד 3 קופונים נבחרים (`showInWidget`) בסדר שהמשתמש הגדיר (`widgetDisplayOrder`).
- חיווי מצב תוקף ברור (ברירת מחדל, עוד מעט, קריטי) + קישור ישיר לפתיחת הקופון באפליקציה.
- שמירה על RTL, קריאות ומינימום טקסט כדי שלא יחתך ברוחב ה-Large.

## עיצוב ומבנה (UI)
- **רקע:** גרדיאנט בהיר (מנטה בהיר → אפרסק עדין), עם צל קל כדי להרים את הכרטיס הראשי.
- **כותרת עליונה:** אייקון האפליקציה משמאל, טקסט "קופונים פעילים • יתרה ₪X" במרכז, צבע טקסט אפור-כחול כהה.
- **באנר התראה (אופציונלי):** אם יש קופון במצב קריטי, פס דק עם אייקון אזהרה וטקסט "יש קופונים שעומדים לפוג" על רקע כתמתם בהיר.
- **רשימת קופונים:** עד 3 כרטיסים, ריווח אחיד. כל כרטיס עם רקע לבן/Off-white, צל עדין, פינות מעוגלות.
  - צד שמאל: שם חברה, ולוגו (אם קיים) כעיגול קטן שקוף/לבן מאחור או fallback ראשי תיבות.
  - צד ימין: יתרה `₪123` בגדול.
  - מתחת לימין: "פג בעוד X ימים" בתוך פיל צבעוני; אדום לקריטי (≤3), כתמתם ל"בקרוב" (≤7), אפור בהיר ללא תאריך.
  - כל כרטיס עטוף `Link` ל־`couponmaster://coupon/{id}`.
- **מצב ריק:** טקסט "בחר עד 3 קופונים להצגה ב-Widget" עם אייקון עדין.

## זרימת מידע והתנהגות
- סינון בסיסי נשאר: `showInWidget == true`, `status == "פעיל"`, `remainingValue > 0`.
- הגבלה וסדר: מיון לפי `widgetDisplayOrder ?? 999`, חיתוך ל-3 פריטים.
- חישוב תוקף:
  - `daysToExpire` מחושב מ-`expirationDate` (אם קיים).
  - מצבים: `critical` (≤3), `soon` (≤7), `ok` (>7 או אין תאריך). קופונים שפג תוקפם לא מוצגים.
- סיכומים: שורת סיכום משתמשת ב-`activeCouponsCount` וב-`totalRemainingValue` שכבר מחושבים בטיימליין.
- אינטראקציה: אין כפתורי פעולה ב-Widget; רק `Link` לפתיחת הקופון. לא נדרשת הרשמה/כניסה מחדש.

## שלבים אופרטיביים בקוד
1. **ערכי עיצוב ב-`CouponWidgetExtension/CouponManagerWidget.swift`:** להוסיף סט צבעים בהירים (רקע גרדיאנט, צבעי פילים `ok/soon/critical`, צל כרטיסים) בתוך `WidgetStyle` או מבנה חדש.
2. **לוגיקת תוקף:** להוסיף הרחבה ל-`WidgetCoupon`/פונקציה עזר שמחזירה `daysToExpire` ו-`ExpiryState` (`critical/soon/ok/none`), בשימוש ב-Large בלבד.
3. **עיבוד נתונים ב-`CouponLargeView`:** למיין לפי `widgetDisplayOrder`, לסנן תוקף פג, לחתוך ל-3, ולגזור מצב תוקף לכל קופון לצביעת הפיל.
4. **UI חדש ל-Large:** לבנות מבנה: רקע גרדיאנט + כותרת עליונה + באנר אופציונלי + רשימת כרטיסים. לעדכן `CouponLargeCardView` לעיצוב הכרטיס (שם חברה, לוגו קטן, יתרה מימין, פיל תוקף, רקע בהיר וצל).
5. **Fallback לוגו:** ב-`CompanyLogoView` להוסיף מצב שקוף/בהיר יותר כדי להתאים רקע לבן ולמנוע בליעה של טקסט.
6. **מצבי ריק ושגיאה:** במצב ללא נתונים להציג הודעת ריק, ולשמור על התנהגות ה-`debugMessage` הקיימת ב-`getTimeline` ללא שינוי.
7. **בדיקות ידניות:** לבנות להרצת סימולטור iPhone 15, לבדוק RTL, תוקף ללא תאריך, תוקף קריטי/קרוב, ולוודא שכל כרטיס פותח את הקופון הנכון.

## בדיקות מהירות מוצעות
- `xcodebuild -scheme CouponManagerApp -destination 'platform=iOS Simulator,name=iPhone 15' build`
- וידוא חזותי: RTL, פיל צבעוני מתחלף לפי ימים לתוקף, רווחי טקסט לא נחתכים, לחיצה על כרטיס פותחת את הקופון באפליקציה.
